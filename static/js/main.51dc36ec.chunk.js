(this["webpackJsonpdestiny-2-inventory-manager"]=this["webpackJsonpdestiny-2-inventory-manager"]||[]).push([[0],{199:function(e,t,n){e.exports=n(349)},204:function(e,t,n){},349:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(11),c=n.n(o),i=(n(204),n(34)),s=n(14),u=(n(205),n(206),n(58)),l=n(12),m=n(63);function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r={name:"userAuth",accessToken:e,membershipId:n,expiresIn:Date.now()+1e3*t,membershipType:a};if(e&&window.localStorage.setItem("userAuth",JSON.stringify(r)),!e){var o=JSON.parse(window.localStorage.getItem("userAuth")||"{}");return Object(l.a)({},r,{},o)}return r}function d(e){return Object(l.a)({name:"profile"},e)}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{contentPath:"",version:""};return Object(l.a)({name:"manifest"},e)}function h(e){return Object(l.a)({name:"componentContent"},e)}var v=[p,d,f,h].reduce((function(e,t){var n=t(),a=n.name,r=Object(m.a)(n,["name"]);if(!a)throw new Error("action must return a `type` value");return Object(l.a)({},e,Object(u.a)({},a,r))}),{}),b=Object(a.createContext)(v),y=n(3),g=n(140),O=n(22);var w=n(59),j=n.n(w),E=n(30),I=n.n(E),C="f5a851a085ec464e8c1af199031b6aec",S="https://www.bungie.net/platform";"https://www.bungie.net/en/OAuth/Authorize?client_id=".concat("3770","&response_type=code");function k(e){return e?((!e.accessToken||Date.now()>e.expiresIn)&&(window.location.href="/d2io"),{"x-api-key":C,Authorization:"Bearer ".concat(e.accessToken)}):{"x-api-key":C}}function x(){return Object(a.useContext)(b)}var P=n(60),T=n(62),H=n(139),D=n.n(H);function A(e,t){return e.itemHash&&t.exotic?t.itemHash===e.itemHash:!(e.itemHash&&!t.exotic&&e.content.itemTypeDisplayName===t.content.itemTypeDisplayName)&&!(!e.hash&&t.exotic)}function M(e){var t=e,n=t.reduce((function(e,t){return e+t.mobility}),0),a=t.reduce((function(e,t){return e+t.resilience}),0),r=t.reduce((function(e,t){return e+t.recovery}),0),o=t.reduce((function(e,t){return e+t.discipline}),0),c=t.reduce((function(e,t){return e+t.intellect}),0),i=t.reduce((function(e,t){return e+t.strength}),0);return{mobility:n,resilience:a,recovery:r,discipline:o,intellect:c,strength:i,total:n+a+r+o+c+i}}function N(){var e=Object(P.a)(["\n        font-family: monospace;\n        color: #fff;\n        background: #000;\n        width: 500px;\n        padding: 10px;\n      "]);return N=function(){return e},e}var _="---------------------------------------------------".length;function R(e){var t=e.items,n=e.stats;return r.a.createElement("pre",{className:Object(T.a)(N())},"| ".concat("Stat Total".padEnd(13,".")).concat(n.total," (max: 280)").padEnd(_-1)+"|",r.a.createElement("br",null),"| ".padEnd(_-1)+"|",r.a.createElement("br",null),t.map((function(e,t){var n=[["Mobility",e.mobility],["Resilience",e.resilience],["Recovery",e.recovery],["Discipline",e.discipline],["Intellect",e.intellect],["Strength",e.strength]],a=n.reduce((function(e,t){return e+t[1]}),0),o=n.map((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return"".concat(n.substr(0,3)," ").concat(a)})).join("  ");return r.a.createElement("div",{key:t},"| [".concat(e.content.itemTypeDisplayName,"] ").concat(e.content.displayProperties.name," (").concat(a,")").padEnd(_-1)+"|",r.a.createElement("br",null),"| ".concat(o).padEnd(_-1)+"|")})))}function J(){var e=Object(P.a)(["justify-content: flex-start;"]);return J=function(){return e},e}var z=[["/d2io/optimizer",function(){var e=x(),t=e.state,n=e.dispatch,o=Object(a.useState)(!0),c=Object(s.a)(o,2),u=c[0],m=c[1],p=Object(a.useState)(""),v=Object(s.a)(p,2),b=v[0],y=v[1],g=Object(a.useState)(""),w=Object(s.a)(g,2),j=w[0],E=w[1],C=Object(a.useState)(""),P=Object(s.a)(C,2),H=P[0],N=P[1];Object(a.useEffect)((function(){var e;t.manifest.version?m(!1):Promise.all([(e=t.userAuth,I()({url:"https://www.bungie.net/Platform/Destiny2/".concat(e.membershipType,"/Profile/").concat(e.membershipId),params:{components:"100,102,103,200,201,202,205,300,301,304,305,306,307,800,308,310,309,900,1100"},headers:k(e)})),I()({url:"".concat(S,"/Destiny2/Manifest"),headers:k()})]).then((function(e){var t=Object(s.a)(e,2),a=t[0],r=t[1];return n(f({contentPath:r.data.Response.jsonWorldComponentContentPaths.en.DestinyRecordDefinition,version:r.data.Response.version})),n(d({data:a.data.Response})),Promise.all([I()({url:"https://www.bungie.net".concat(r.data.Response.jsonWorldComponentContentPaths.en.DestinyInventoryItemLiteDefinition)}),I()({url:"https://www.bungie.net".concat(r.data.Response.jsonWorldComponentContentPaths.en.DestinyPowerCapDefinition)})])})).then((function(e){var t=Object(s.a)(e,2),a=t[0],r=t[1];n(h(Object(l.a)({},a.data,{powercaps:r.data}))),m(!1)}))}),[t.userAuth,t.manifest,m]);var _=Object(a.useCallback)((function(e){return y(e.target.value)}),[]),z=Object(a.useCallback)((function(e){E(e.target.value),N("")}),[]),L=Object(a.useCallback)((function(e){return N(e.target.value)}),[]),B=Object(a.useMemo)((function(){return t.profile.data&&t.profile.data.profileInventory&&0!==Object.keys(t.componentContent).length?function(e,t){var n=e.profileInventory.data.items,a=Object.keys(e.characterInventories.data).map((function(t){return e.characterInventories.data[t].items})),r=e.itemComponents.stats.data;return[].concat(Object(i.a)(n),Object(i.a)(a)).filter((function(e){return e.itemInstanceId&&t[e.itemHash].equippingBlock&&t[e.itemHash].quality&&r[e.itemInstanceId].stats[144602215]})).map((function(e){return Object(l.a)({},e,{content:t[e.itemHash],exotic:"exotic_armor"===t[e.itemHash].equippingBlock.uniqueLabel,classType:t[e.itemHash].classType,powerCap:t.powercaps[t[e.itemHash].quality.versions[0].powerCapHash].powerCap,intellect:r[e.itemInstanceId].stats[144602215].value,mobility:r[e.itemInstanceId].stats[2996146975].value,strength:r[e.itemInstanceId].stats[4244567218].value,discipline:r[e.itemInstanceId].stats[1735777505].value,recovery:r[e.itemInstanceId].stats[1943323491].value,resilience:r[e.itemInstanceId].stats[392767087].value})}))}(t.profile.data,t.componentContent):[]}),[t.profile,t.componentContent]),G=function(e){var t=e.powerCap,n=e.exoticItem,a=e.items,r=e.mainClass,o=[],c=[],i=[],s=[];return 0===a.length||""===r||a.filter((function(e){return e.powerCap>=t})).filter((function(e){return e.classType.toString()===r.toString()})).forEach((function(e){switch(e.content.itemTypeDisplayName){case"Helmet":A(n,e)&&o.push(e);break;case"Gauntlets":A(n,e)&&c.push(e);break;case"Chest Armor":A(n,e)&&i.push(e);break;case"Leg Armor":A(n,e)&&s.push(e)}})),{helmets:o,gauntlets:c,chests:i,legs:s}}({powerCap:1260,exoticItem:B.filter((function(e){return e.itemHash.toString()===H.toString()}))[0]||{},items:B,mainClass:j}),W=D()(B.filter((function(e){return e.exotic&&e.classType.toString()===j.toString()})),(function(e){return e.itemHash})),q=G.helmets,F=G.gauntlets,U=G.chests,$=G.legs,K=Object(a.useMemo)((function(){var e=[];return"PvP - Standard"===b&&q.forEach((function(t){F.forEach((function(n){U.forEach((function(a){$.forEach((function(r){var o=[t,n,a,r];(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:220,n=M(e),a=n.mobility,r=n.recovery,o=n.discipline,c=n.intellect,i=n.strength,s=n.total;return a<=59&&r>=60&&a%10>=5&&[r%10<=4,c%10<=4,o%10<=4,i%10<=4].filter((function(e){return e})).length>=4&&s>=t})(o)&&e.push({set:o,stats:M(o)})}))}))}))})),"PvE - Standard"===b&&q.forEach((function(t){F.forEach((function(n){U.forEach((function(a){$.forEach((function(r){var o=[t,n,a,r];(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:220,n=M(e),a=n.mobility,r=n.recovery,o=n.discipline,c=n.intellect,i=n.strength,s=n.total;return r>=60&&o>=50&&[a%10<=4,r%10<=4,c%10<=4,o%10<=4,i%10<=4].filter((function(e){return e})).length>=4&&s>=t})(o)&&e.push({set:o,stats:M(o)})}))}))}))})),e.sort((function(e,t){return t.stats.total-e.stats.total}))}),[q,F,U,$,b]);return console.log(K),u?r.a.createElement("div",null,r.a.createElement(O.Spinner,{className:Object(T.a)(J())}),"Loading profile data..."):r.a.createElement("div",{style:{padding:15}},r.a.createElement("div",{style:{width:300}},r.a.createElement(O.FormGroup,{label:"Optimizer Presets"},r.a.createElement(O.HTMLSelect,{options:["","PvP - Standard","PvE - Standard"],onChange:_,value:b})),r.a.createElement(O.FormGroup,{label:"Class"},r.a.createElement(O.HTMLSelect,{options:[{label:"",value:""},{label:"Titan",value:0},{label:"Hunter",value:1},{label:"Warlock",value:2}],onChange:z,value:j})),r.a.createElement(O.FormGroup,{label:"Exotic"},r.a.createElement(O.HTMLSelect,{options:[{label:"",value:""}].concat(Object(i.a)(W.map((function(e){return{label:e.content.displayProperties.name,value:e.itemHash}})))),onChange:L,value:H})),r.a.createElement(O.FormGroup,{label:"Power Cap Minimum"},r.a.createElement("strong",null,"1260")),r.a.createElement("hr",null)),K.map((function(e,t){var n=e.set,a=e.stats;return r.a.createElement(R,{key:t,items:n,stats:a})})))}]].map((function(e){var t,n=Object(s.a)(e,2),a=n[0],o=n[1];return[a,(t=o,function(e){var n=x().state;return!n.userAuth.accessToken||Date.now()>=n.userAuth.expiresIn?r.a.createElement(y.a,{to:"/d2io"}):r.a.createElement(t,e)})]})),L=[["/d2io",function(){return r.a.createElement("div",null,r.a.createElement(O.AnchorButton,{href:"https://www.bungie.net/en/OAuth/Authorize?client_id=3770&response_type=code"},"Sync Destiny 2 Characters"))}],["/d2io/auth",function(e){var t=e.location,n=x(),o=n.dispatch,c=n.state,i=Object(y.g)();return Object(a.useEffect)((function(){var e=j.a.parse(t.search);e.code&&function(e){return I()({method:"POST",headers:Object(l.a)({},k(),{"content-type":"application/x-www-form-urlencoded"}),data:j.a.stringify({code:e,grant_type:"authorization_code",client_id:"3770"}),url:(t="/app/oauth/token/",S+t)});var t}(e.code||"").then((function(e){var t,n=p(e.data.access_token,e.data.expires_in);return Promise.all([e,(t=n,I()({url:"".concat(S,"/User/GetMembershipsForCurrentUser"),headers:k(t)}))])})).then((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];o(p(n.data.access_token,n.data.expires_in,a.data.Response.destinyMemberships[0].membershipId,a.data.Response.destinyMemberships[0].membershipType))}))}),[o,t,i]),Date.now()>c.userAuth.expiresIn?r.a.createElement("div",null,"authenticating..."):r.a.createElement(y.a,{to:"/d2io/optimizer"})}]].concat(Object(i.a)(z)).map((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return r.a.createElement(y.b,{key:n,component:a,path:n,exact:!0})}));var B=function(){var e=Object(a.useReducer)((function(e,t){var n=t.name,a=Object(m.a)(t,["name"]);return e[n]=a,JSON.parse(JSON.stringify(e))}),v),t=Object(s.a)(e,2),n=t[0],o=t[1];return r.a.createElement(b.Provider,{value:{state:JSON.parse(JSON.stringify(n)),dispatch:o}},r.a.createElement(g.a,null,r.a.createElement(y.d,null,L)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(B,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[199,1,2]]]);
//# sourceMappingURL=main.51dc36ec.chunk.js.map