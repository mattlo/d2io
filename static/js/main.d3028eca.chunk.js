(this["webpackJsonpdestiny-2-inventory-manager"]=this["webpackJsonpdestiny-2-inventory-manager"]||[]).push([[0],{147:function(e,t,n){e.exports=n(211)},152:function(e,t,n){},211:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(11),i=n.n(o),c=(n(152),n(89)),s=n(21),u=(n(153),n(154),n(43)),l=n(19),d=n(45);function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r={name:"userAuth",accessToken:e,membershipId:n,expiresIn:Date.now()+1e3*t,membershipType:a};if(e&&window.localStorage.setItem("userAuth",JSON.stringify(r)),!e){var o=JSON.parse(window.localStorage.getItem("userAuth")||"{}");return Object(l.a)({},r,{},o)}return r}function p(e){return Object(l.a)({name:"profile"},e)}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{contentPath:"",version:""};return Object(l.a)({name:"manifest"},e)}function f(e){return Object(l.a)({name:"componentContent"},e)}var v=[h,p,m,f].reduce((function(e,t){var n=t(),a=n.name,r=Object(d.a)(n,["name"]);if(!a)throw new Error("action must return a `type` value");return Object(l.a)({},e,Object(u.a)({},a,r))}),{}),b=Object(a.createContext)(v),w=n(3),O=n(88),g=n(82);var y=n(44),j=n.n(y),E=n(29),A=n.n(E),k="f5a851a085ec464e8c1af199031b6aec",x="https://www.bungie.net/platform",S="https://www.bungie.net/en/OAuth/Authorize?client_id=".concat("3770","&response_type=code");function D(e){return e?((!e.accessToken||Date.now()>e.expiresIn)&&(window.location.href="/d2io"),{"x-api-key":k,Authorization:"Bearer ".concat(e.accessToken)}):{"x-api-key":k}}function I(){return Object(a.useContext)(b)}var P=[["/d2io/optimizer",function(){var e=I(),t=e.state,n=e.dispatch,o=Object(a.useState)(!0),i=Object(s.a)(o,2),c=i[0],u=i[1];return Object(a.useEffect)((function(){var e;t.manifest.version?u(!1):Promise.all([(e=t.userAuth,A()({url:"https://www.bungie.net/Platform/Destiny2/".concat(e.membershipType,"/Profile/").concat(e.membershipId),params:{components:"100,102,103,200,201,202,205,300,301,304,305,306,307,800,308,310,309,900,1100"},headers:D(e)})),A()({url:"".concat(x,"/Destiny2/Manifest"),headers:D()})]).then((function(e){var t=Object(s.a)(e,2),a=t[0],r=t[1];return n(m({contentPath:r.data.Response.jsonWorldComponentContentPaths.en.DestinyRecordDefinition,version:r.data.Response.version})),n(p({data:a.data.Response})),A()({url:"https://www.bungie.net".concat(r.data.Response.jsonWorldComponentContentPaths.en.DestinyRecordDefinition)})})).then((function(e){n(f(e.data)),u(!1)}))}),[t.userAuth,t.manifest,u]),c?r.a.createElement("div",null,"Loading profile data..."):r.a.createElement("div",null,"loadout optimizer page test2")}]].map((function(e){var t,n=Object(s.a)(e,2),a=n[0],o=n[1];return[a,(t=o,function(e){var n=I().state;return!n.userAuth.accessToken||Date.now()>=n.userAuth.expiresIn?(window.location.href=S,r.a.createElement("div",null)):r.a.createElement(t,e)})]})),C=[["/d2io",function(){return r.a.createElement("div",null,r.a.createElement(g.AnchorButton,{href:"https://www.bungie.net/en/OAuth/Authorize?client_id=3770&response_type=code"},"Sync Destiny 2 Characters"))}],["/d2io/auth",function(e){var t=e.location,n=I(),o=n.dispatch,i=n.state,c=Object(w.g)();return Object(a.useEffect)((function(){var e=j.a.parse(t.search);e.code&&function(e){return A()({method:"POST",headers:Object(l.a)({},D(),{"content-type":"application/x-www-form-urlencoded"}),data:j.a.stringify({code:e,grant_type:"authorization_code",client_id:"3770"}),url:(t="/app/oauth/token/",x+t)});var t}(e.code||"").then((function(e){return Promise.all([e,(t=i.userAuth,A()({url:"".concat(x,"/User/GetMembershipsForCurrentUser"),headers:D(t)}))]);var t})).then((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];o(h(n.data.access_token,n.data.expires_in,a.data.Response.destinyMemberships[0].membershipId,a.data.Response.destinyMemberships[0].membershipType))}))}),[o,t,c]),Date.now()>i.userAuth.expiresIn?r.a.createElement("div",null,"authenticating..."):r.a.createElement(w.a,{to:"/d2io/optimizer"})}]].concat(Object(c.a)(P)).map((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return r.a.createElement(w.b,{key:n,component:a,path:n,exact:!0})}));var R=function(){var e=Object(a.useReducer)((function(e,t){var n=t.name,a=Object(d.a)(t,["name"]);return e[n]=a,JSON.parse(JSON.stringify(e))}),v),t=Object(s.a)(e,2),n=t[0],o=t[1];return r.a.createElement(b.Provider,{value:{state:JSON.parse(JSON.stringify(n)),dispatch:o}},r.a.createElement(O.a,null,r.a.createElement(w.d,null,C)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(R,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[147,1,2]]]);
//# sourceMappingURL=main.d3028eca.chunk.js.map