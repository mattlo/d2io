(this["webpackJsonpdestiny-2-inventory-manager"]=this["webpackJsonpdestiny-2-inventory-manager"]||[]).push([[0],{147:function(e,t,n){e.exports=n(211)},152:function(e,t,n){},211:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(11),c=n.n(o),i=(n(152),n(89)),s=n(31),u=(n(153),n(154),n(42)),l=n(25),h=n(44);function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r={name:"userAuth",accessToken:e,membershipId:n,expiresIn:Date.now()+1e3*t,membershipType:a};if(e&&window.localStorage.setItem("userAuth",JSON.stringify(r)),!e){var o=JSON.parse(window.localStorage.getItem("userAuth")||"{}");return Object(l.a)({},r,{},o)}return r}var p=[d].reduce((function(e,t){var n=t(),a=n.name,r=Object(h.a)(n,["name"]);if(!a)throw new Error("action must return a `type` value");return Object(l.a)({},e,Object(u.a)({},a,r))}),{}),m=Object(a.createContext)(p),f=n(3),v=n(88),w=n(82);var b=n(43),O=n.n(b),g=n(53),y=n.n(g),j="f5a851a085ec464e8c1af199031b6aec",E="https://www.bungie.net/en/OAuth/Authorize?client_id=".concat("3770","&response_type=code");function A(e){return e?((!e.accessToken||Date.now()>=e.expiresIn)&&(window.location.href=E),{"x-api-key":j,Authorization:"Bearer ".concat(e.accessToken)}):{"x-api-key":j}}function k(){return Object(a.useContext)(m)}var x=[["/d2io/optimizer",function(){var e=k().state;return Object(a.useEffect)((function(){console.log(e.userAuth)}),[e.userAuth]),r.a.createElement("div",null,"loadout optimizer page")}]].map((function(e){var t,n=Object(s.a)(e,2),a=n[0],o=n[1];return[a,(t=o,function(e){var n=k().state;return!n.userAuth.accessToken||Date.now()>=n.userAuth.expiresIn?(window.location.href=E,r.a.createElement("div",null)):r.a.createElement(t,e)})]})),S=[["/d2io",function(){return r.a.createElement("div",null,r.a.createElement(w.AnchorButton,{href:"https://www.bungie.net/en/OAuth/Authorize?client_id=3770&response_type=code"},"Sync Destiny 2 Characters"))}],["/d2io/auth",function(e){var t=e.location,n=k(),o=n.dispatch,c=n.state,i=Object(f.f)();return Object(a.useEffect)((function(){var e=O.a.parse(t.search);e.code&&function(e){return y()({method:"POST",headers:Object(l.a)({},A(),{"content-type":"application/x-www-form-urlencoded"}),data:O.a.stringify({code:e,grant_type:"authorization_code",client_id:"3770"}),url:(t="/app/oauth/token/","https://www.bungie.net/platform"+t)});var t}(e.code||"").then((function(e){return Promise.all([e,(t=c.userAuth,y()({url:"https://www.bungie.net/Platform/User/GetMembershipsForCurrentUser",headers:Object(l.a)({},A(t))}))]);var t})).then((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];o(d(n.data.access_token,n.data.expires_in,a.data.Response.destinyMemberships[0].membershipId,a.data.Response.destinyMemberships[0].membershipType)),i.push("/d2io/optimizer")}))}),[o,t,i]),r.a.createElement("div",null,"authenticating...")}]].concat(Object(i.a)(x)).map((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return r.a.createElement(f.a,{key:n,component:a,path:n,exact:!0})}));var _=function(){var e=Object(a.useReducer)((function(e,t){var n=t.name,a=Object(h.a)(t,["name"]);return e[n]=a,JSON.parse(JSON.stringify(e))}),p),t=Object(s.a)(e,2),n=t[0],o=t[1];return r.a.createElement(m.Provider,{value:{state:JSON.parse(JSON.stringify(n)),dispatch:o}},r.a.createElement(v.a,null,r.a.createElement(f.c,null,S)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(_,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[147,1,2]]]);
//# sourceMappingURL=main.d70e229b.chunk.js.map